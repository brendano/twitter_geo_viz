<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <title>Albers Projection</title>
    <script type="text/javascript" src="d3.js"></script>
    <script type="text/javascript" src="d3.geo.js"></script>
    <script type="text/javascript" src="lib/jquery/jquery.min.js"></script>
    <script type="text/javascript" src="lib/jquery-ui/jquery-ui.min.js"></script>
    <script type="text/javascript" src="us_states.js"></script>
    <style type="text/css">

@import url("lib/jquery-ui/jquery-ui.css");

body {
  font: 14px Helvetica Neue;
}

svg {
  width: 960px;
  height: 500px;
  border: solid 1px #ccc;
  background: #f0f0f0;
}

.states path {
  fill: #ccc;
  stroke: #fff;
}

.symbols circle {
  fill: none;
  stroke: steelblue;
}

div {
  width: 960px;
}

    </style>
  </head>
  <body>
    <h3>Twitter Words</h3>
    <script type="text/javascript">

// Our projection.
var xy = d3.geo.albers(),
    path = d3.geo.path().projection(xy);

var svg = d3.select("body")
  .append("svg:svg");
  
var states = svg.append("svg:g")
  .attr('class', 'states');

var symbols = svg.append("svg:g")
  .attr('class', 'symbols');

function render_geo(collection) {
  states.selectAll("path")
      .data(us_states.features)
    .enter().append("svg:path")
      .attr("d", path);
}

render_geo(us_states);

function plot_userlocs(userlocs) {
  var sel = symbols.selectAll('circle').data(userlocs);
  
  function transformer(d) {
    return "translate(" + xy(d).join(",") + ")";
  }
  
  sel.enter().append("svg:circle")
    .attr("r", 4)
    //.attr("transform", function() { return "translate(" + (960*Math.random()) + "," + (500*Math.random()) + ")" })
    .attr("transform", transformer)
    .attr("opacity", 0)
      .transition()
      .duration(500)
      .delay(function(d,i) { return i*10; })
      .attr("transform", transformer)
      .attr("opacity", 1);
    
    
  sel.attr("transform", transformer);
  
  sel.exit().remove();
}

$.ajax({
  url: 'http://www.ark.cs.cmu.edu/twigeo/api/query.cgi?wordid=80000&callback=?',
  dataType: 'jsonp',
  success: function(json) {
    if (json.status === 'success') {
      var locs = [];
      json.data.forEach(function(d) {
        locs.push(d.locs);
      })
      locs = [].concat.apply([], locs);
      plot_userlocs(locs)
    } else {
      // handle this!
    }
  }
})

    </script>
  </body>
</html>








